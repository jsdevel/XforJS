!function(){/*

 Copyright 2012 Joseph Spencer.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Version: 1.0.3

 For demos and docs visit http://jsdevel.github.com/XforJS/
 For viewing source visit http://github.com/jsdevel/XforJS/
*/
function g(a){throw a;}var j=!0,m=!1;function p(){return function(){}}
var s,ca={server:j,getCompiler:function(a){return new aa(a)},getLib:function(a){return ba(a)},buildOutputLibrary:function(a,b){var c,d;if(ca.Ca)try{c=require("fs"),c.existsSync(a)&&c.statSync(a).isDirectory()&&g("Can't overwrite the following directory with the library: "+a),d=ba(b),c.writeFileSync(a,d)}catch(h){g("The following happened while attempting to write to '"+a+"':\n"+h)}else g("Unable to output library in a non-server environment.  Configure XforJS.server=true;");return this}};
function t(a,b){a.prototype=new b;a.prototype.constructor=a}
var da=/^((?:[^\}\\]|\\[\}\\])+\.xjs)/,ea=/^((?:[^#'\{\\]|\\(?:#|'|\\|\{))+)/,u=/^([a-zA-Z$_](?:[\w$]+)?)/,fa=/^([a-zA-Z$_](?:[\w$]+)?(?:(?:\.[a-zA-Z$_](?:[\w$]+)?)+)?)/,ga=/^([a-zA-Z$_](?:[\w$]+)?(?:\.[a-zA-Z$_](?:[\w$]+)?)+)/,ha=/^(\|(?:asc|desc|rand))(?![\w$])/,ia=/^(\|[cCin]{1,4})(?![\w$])/,ja=/^((?:\s|#(?:[^\r\n]+)?(?:\r?\n))+)/,ka=/(>|<)\s+|\s+(>|<)/g,la=/^((?:\s|#(?:[^\r\n]+)?(?:\r?\n))+)(?=\{)/,ma=/^((?:(?!\{\/text\})[\s\S])+)(?=\{\/text\})/,na=/^@([a-zA-Z$_](?:[\w$]+)?)\s*[\.\[]/,oa=/^(@([a-zA-Z$_](?:[\w$]+)?))/,
pa=/^(\{call\s+)/,qa=/^(\{\/call\})/,ra=/^(\{foreach\s+)/,sa=/^(\{\/foreach\})/,ta=/^(\{if\s+)/,ua=/^(\{\/if\})/,va=/^(\{import\s+)/,wa=/^(\{log\s+)/,xa=/^(\{namespace\s+)/,w=/^(\{param\s+)/,ya=/^(\{sort\s+)/,za=/^(\{template\s+)/,Aa=/^(\{\/template\})/,Ba=/^(\{text\})/,Ca=/^(\{\/text\})/,x=/^(\{var\s+)/,Da=/^(\{:elif\s+)/,Ea=/^(count\()/,Fa=/^(current\(\))/,Ga=/^(last\(\))/,Ha=/^(name\(\))/,Ia=/^(position\(\))/,Ja=/^(false|true)(?![\w$])/,Ka=/^((?:0x(?=([0-9A-Fa-f]+))\2(?!\.)|(?=(0(?![0-9])|[1-9][0-9]*))\3(?!x)(?:\.[0-9]+)?)(?:[eE][-+][0-9]+)?)/,
La=/^(null)(?![\w$])/,Ma=/^((['"])(?=((?:(?:(?!\2|\r?\n|\\)[\s\S]|\\(?:\\|\2|\r?\n))+)?))\3\2)/,Na={"break":j,"case":j,"catch":j,"continue":j,"debugger":j,"default":j,"delete":j,"do":j,"else":j,"finally":j,"for":j,"function":j,"if":j,"in":j,"instanceof":j,"new":j,"return":j,"switch":j,"this":j,"throw":j,"try":j,"typeof":j,"var":j,"void":j,"while":j,"with":j,"class":j,"const":j,"enum":j,"export":j,"extends":j,"import":j,"super":j,"implements":j,"interface":j,let:j,"package":j,"private":j,"protected":j,
"public":j,"static":j,yield:j};function y(a){var b=a.split("."),c=0,d=b.length;for((!a||!fa.test(a))&&g("Invalid namespace given: '"+a+"'.");c<d;c++)Na[b[c]]&&g("Usage of the following ECMAScript reserved word is not allowed: "+b[c])}
function Oa(a){var b=require("fs"),c=require("path");(!a||"string"!==typeof a)&&g("inputFilePath must be a string.");a=c.normalize(a.replace(/^\s+|\s+$/g,""));/\.xjs$/.test(a)||g("inputFilePath must end with '.xjs'.");b.existsSync(a)||g("The following path doesn't exist: \n   "+a);return c.resolve(a)}var z="b",A="x",B="N",Pa="A",C="L",Qa="n",Ra="P",Sa="M",Ta="O",F="B",G="C",Ua="X",Va="F",H="G",Wa="V",Ya="S",Za="XforJS.js";
function $a(a){var b,c=0,d;try{b=a()}catch(h){b=a}if(b&&"object"===typeof b){if(b.slice&&b.join&&b.pop)return b.length>>>0;for(d in b)c++}return c}function ab(a){return"string"===typeof a?a.replace(/&(?![a-zA-Z]+;|#[0-9]+;)/g,"&amp;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/&(?![a-zA-Z]+;|#[0-9]+;)/g,"&#96;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):a}
function bb(a,b,c,d,h,e){var k,f,l=0===c;if(a instanceof Array&&"function"===typeof b){k=a.length;if(void 0!==c)if(1<c){c=[];f=0;for(var n=a.length,v;f<n;f++)v=~~(Math.random()*(c.length+1)),c.splice(v,0,a[f]);a=c}else{c=a;f=function(a,b){var c=a.K,f=b.K,q=a.W,k=b.W,n=q[0]!==c[0],r=k[0]!==f[0],v=a.$,D=b.$,E="number"===v,Xa="number"===D;if(c===f)return 0;if(E!==Xa)return d?v>D?1:0:v>D?0:1;if(E&&Xa)return l?c>f?1:0:c>f?0:1;if(!q&&!k)return 0;if(!q&&k)return 1;if(q&&!k)return 0;switch(h){case 0:return l?
e?q>k?1:0:c>f?1:0:e?q===k?0:q>k?0:1:n&&!r?0:!n&&r?1:c>f?0:1;case 1:return l?e?q===k?n&&!r?1:0:q>k?1:-1:n&&!r?1:!n&&r?0:c>f?1:-1:e?q===k?n&&!r?1:-1:q>k?-1:1:n&&r||!n&&!r?c>f?-1:1:n?1:-1;case 2:return l?e?q===k?n&&!r?-1:!n&&r?1:0:q>k?1:-1:n&&r||!n&&!r?c>f?1:-1:n?-1:1:e?q===k?n&&!r?-1:!n&&r?1:0:q>k?-1:1:n&&r||!n&&!r?c>f?-1:1:n?-1:1}};n=c.length;v=n*n;for(var r=0,q=1,D=q-1,E=0;q<n&&!(r>v);q++)r++,1===f(c[q-1],c[q])?(c.splice(q,0,c.splice(q-1,1)[0]),q-=2,0>q&&(q=0),E=1):E?(E=0,q=D):D++}for(c=0;c<k;c++)f=
a[c],b(f.P,c+1,a.length,f.X)}}
function ba(a){var b=Za;void 0!==a&&(b=a,y(b));return'/**\n * @preserve\n * Copyright 2012 Joseph Spencer.\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * Version: __VERSION__\n *\n * For demos and docs visit http://jsdevel.github.com/XforJS/\n * For viewing source visit http://github.com/jsdevel/XforJS/\n */\n'+b+
"={\n"+G+":"+$a.toString()+",\n"+Ua+":"+ab.toString()+",\n"+Va+":"+bb.toString()+",\n"+Wa+":"+cb.toString()+",\n"+H+":"+db.toString()+",\n"+Ya+":"+eb.toString()+"\n};"}function db(a,b){var c=[],d,h,e,k;try{e=a()}catch(f){e=a}if(e&&"object"===typeof e)for(d in e)try{h=b(e[d]),k=typeof h,c.push({X:d,P:e[d],W:"string"===k?h.toLowerCase():"",$:k,K:"string"===k||"number"===k?h:""})}catch(l){c.push({X:d,P:e[d],Ba:"",K:"",za:""})}return c}
function cb(a){try{return a()}catch(b){return"function"===typeof a?void 0:a}}function eb(){function a(a){var h;try{h=a()}catch(e){h=a}b[c++]=-1<"number string boolean".indexOf(typeof h)?h:""}var b=[],c=0;a.s=function(){return b.join("")};return a}function I(){var a=[];this.add=function(b){a.push(b);return this};this.toString=function(){return a.join("")}}
function fb(a,b,c,d,h){var e=this,k={},f=[],l=[],n=b||"";"string"!==typeof a&&g("Prefix is required.");"string"!==typeof c&&g("Seperator is required.");"string"!==typeof d&&g("Postfix is required");this.add=function(a,b){var c=n+a;k.hasOwnProperty(c)&&g("The following has been declared twice: "+a);b&&"object"===typeof b||"string"===typeof b||g('Null value was discovered for the following: "'+a+'"');k[c]=b;f.push(c);return e};this.V=function(a){return k.hasOwnProperty(n+a)||h&&h.V(a)?j:m};this.qa=
function(){return n};this.toString=function(){var b,e,h=0;if(0<f.length){b=f.shift();e=k[b].toString();l.push(a+b);""!==e&&l.push(c+e);for(b=f.length;h<b;h++)e=f[h],l.push(","+e),e=k[e],e.toString()&&l.push(c+e);l.push(d)}return l.join("")}}function gb(){var a=[],b=[],c={};this.put=function(d,h){!c.hasOwnProperty(d)&&(d&&h)&&(a.push(d),b.push(h),c[d]=j);return this};this.pa=function(){return a.join(",")};this.fa=function(){return b.join(",")}}
function hb(a){this.toString=function(){return a.pa()}}function ib(a){this.toString=function(){return a.fa()}}
function jb(a){var b,c,d,h,e,k,f=a.libnamespace;(!a||"object"!==typeof a)&&g("args must be an object.");a.useexternal?(f?y(f):f=Za,b=f+"."+G,c=f+"."+Ua,d=f+"."+Va,h=f+"."+Wa,e=f+"."+H,k=f+"."+Ya):(b=$a.toString(),c=ab.toString(),d=bb.toString(),h=cb.toString(),e=db.toString(),k=eb.toString());this.ja=function(){return b};this.ka=function(){return c};this.la=function(){return d};this.ma=function(){return h};this.R=function(){return e};this.na=function(){return k}}
function kb(a){var b="string"===typeof a&&a||"",c=1,d=1;this.length=function(){return b.length};this.charAt=function(a){a=a||0;a>=b.length&&g("There are no more characters to parse.");return b[a]};this.shift=function(a){var e=0,k;if(-1<b.length-~~a){for(e=0;e<a;e++)switch(k=b[e],k){case "\r":"\n"===b[e+1]&&e++;case "\n":c++;d=1;continue;default:d++}b=b.slice(a)}else g("Can't shift.  Nothing left to parse.");return this};this.match=function(a){return a.exec(b)};this.c=function(){var a=ja.exec(b);return a?
(this.shift(a[1].length),j):m};this.ta=function(){return 0===b.indexOf("{:else}")};this.oa=function(){return c};this.ha=function(){return d}}function J(){}J.prototype.execute=p();J.prototype.Q=function(){g("Block continuations are not allowed here.")};J.prototype.close=function(){g('Unable to close: "'+this.constructor.name+'"')};J.prototype.name="Production";
function lb(a,b,c){a instanceof I||g("output must be of type Output.");b instanceof aa||g("compiler must be of type Compiler.");c&&!(c instanceof lb)&&g("previousContext must be of type ProductionContext.");var d=new fb("var ","__","=",";",void 0),h=[d],e,k=[],f,l,n;c?(this.v=c.v,this.e=c.e,this.t=c.t,this.r=c.r,this.z=c.z,this.k=c.k,this.d=c.d,n=c.ga()):(this.v={},this.e=new gb,this.t=new hb(this.e),this.r=new ib(this.e),this.z={},this.k=b.ca,this.d=b.d,n=new mb);var v=this.k,r=[v];this.Da=function(a){var b;
if(a&&"object"===typeof a){for(b in v)a.hasOwnProperty(b)||(a[b]=v[b]);r.push(a);this.k=v=a}else g("obj must be an object.");return this};this.i=function(a){return v[a]};this.Aa=function(){1<r.length?(r.pop(),this.k=v=r[r.length-1]):g("Can't remove default configuration.");return this};this.xa=function(){return this.e};this.wa=function(){return this.t};this.va=function(){return this.r};this.Z=function(a){a||g("invalid namespace given.");f||(f=a);this.v[a]=j};this.S=function(){f||g("no namespace has been declared.");
return f||""};this.ya=function(a){return this.v[a]};this.sa=function(a){l&&g("can't set path more than once.");l=Oa(a)};this.ra=function(a){l||g("Can't import '"+a+"' because no inputFilePath was given to the ProductionContext.");var c=require("path"),d=require("fs"),e=c.dirname(l);a=Oa(c.resolve(e,a));if(this.z[a])return"";this.z[a]=j;d=d.readFileSync(a,"utf8");return b.compile(d,a,this)};this.a=function(a){k.push(a);e=a};this.b=function(){k.length||g("There is no production to remove from context.");
k.pop();e=k[k.length-1];return this};this.ea=function(a){e.execute(a,this)};this.da=function(a){e.Q(a,this)};this.ia=function(){return e};this.h=function(){return d};this.O=function(){var a=new fb("var ","__","=",";",d);d=a;h.push(a)};this.Y=function(){var a=h.length;1<a?(h.pop(),d=h[a-2]):g("Illegal attempt to remove VariableOutput.")};this.L=function(a){d.V(a)||g('Variable "'+a+"\" hasn't been declared yet.")};this.ga=function(){return n};this.J=function(a){n.J(a);return this};this.A=function(a){n.A(a);
return this};this.T=function(a){return n.T(a)};this.U=function(a){return n.U(a)};this.close=function(){var a=k.length,b=a-1;if(a)for(;-1<b;b--)k[b].close(this);else g("No productions were found.");n.ua()}}function K(){}t(K,J);K.prototype.name="AbstractAssignment";K.prototype.execute=function(a,b){this.l?b.b():(this.l=j,b.a(this.getExpression()))};K.prototype.getExpression=p();function L(){}t(L,J);s=L.prototype;s.name="AbstractConditionBlock";s.M=m;s.N=j;s.w=j;s.B=p();s.C=p();s.I=p();
s.execute=function(a,b){var c;if(this.N)b.a(this.I()),this.N=m;else{a.c();switch(a.charAt(0)){case "/":if(this.w&&this.M&&"}"===a.charAt(1)){a.shift(2);b.b();return}g("Unexpected '/'");case "}":if(this.w){a.shift(1);this.w=m;b.a(this.B());return}break;case "{":if(!this.w&&"/"===a.charAt(1)&&(c=a.match(this.C()))){a.shift(c[1].length);b.b();return}}g("Invalid Expression found.")}};function M(){}t(M,J);s=M.prototype;s.name="AbstractExpression";s.m=m;s.g=m;s.aa=/^([!~]+)/;s.ba=/^(typeof)(?=[\(\s])/;
s.execute=function(a,b){var c=this.f();a.c();if("}"!==a.charAt(0)){if(this.g===m||this.m){this.m=m;this.g=j;var d;switch(a.charAt(0)){case "!":case "~":d=a.match(this.aa);d=d[1];a.shift(d.length);a.c();c.add(d);break;case "t":if(d=a.match(this.ba))a.shift(d[1].length),c.add("typeof"),a.c(),"("!==a.charAt(0)&&c.add(" ")}"("===a.charAt(0)?(a.shift(1),d=new I,c.add(d),b.a(this.G(d))):b.a(this.H());return}if(this.g)switch(a.charAt(0)){case "]":case ")":break;default:this.m=j;this.g=m;b.a(new nb(c));return}}this.g&&
!this.m?b.b():(this.m&&g("Unclosed Operator."),g("Empty Expression."))};s.H=p();s.G=p();s.f=p();function N(){}t(N,J);s=N.prototype;s.name="AbstractVariableDeclaration";
s.execute=function(a,b){a.c();if(!this.g){this.g=j;var c=a.match(this.p());if(c)if(a.shift(c[1].length),a.c(),c=a.match(u)){c=c[1];a.shift(c.length);if(a.c()){var d=new I;this.n(c,d);this.j().add(c,d);b.a(this.q(d));return}this.o(c,b)}else g("No valid name was found.");else g("Invalid start tag.")}this.g&&"}"===a.charAt(0)?(a.shift(1),b.b()):g("Invalid character found.")};s.p=p();s.j=p();s.q=p();s.n=p();s.o=p();
function O(){this.execute=function(a,b){a.c();"{"===a.charAt(0)&&a.charAt(1)===this.u&&a.match(this.F())?b.a(this.D()):b.b()}}t(O,J);O.prototype.name="AbstractVariableDeclarations";O.prototype.u="";O.prototype.D=p();O.prototype.F=p();
function P(){this.execute=function(a,b){a.c();switch(a.charAt(0)){case ")":this.l||g("Empty Expressions are not allowed.");a.shift(1);b.b();return;default:if(!this.l){this.l=j;var c=new I;this.f().add("(").add(c).add(")");b.a(this.getExpression(c));return}}g("Possibly an unclosed paren was found.")}}t(P,J);P.prototype.l=m;P.prototype.getExpression=p();P.prototype.f=p();
function nb(a){this.execute=function(b,c){var d="";b.c();switch(b.charAt(0)){case "=":if("="===b.charAt(1)){"="===b.charAt(2)?(b.shift(3),d="==="):(b.shift(2),d="==");a.add(d);c.b();return}break;case "!":if("="===b.charAt(1)){"="===b.charAt(2)?(b.shift(3),d="!=="):d="!=";a.add(d);c.b();return}break;case "|":if("|"===b.charAt(1)){b.shift(2);a.add("||");c.b();return}break;case "&":if("&"===b.charAt(1)){b.shift(2);a.add("&&");c.b();return}break;case "<":case ">":if("="===b.charAt(1)){a.add(b.charAt(0)+
"=");b.shift(2);c.b();return}case "+":case "-":case "%":case "*":case "/":a.add(b.charAt(0));b.shift(1);c.b();return}g("Invalid Operator.")}}t(nb,J);nb.prototype.name="Operator";
function ob(a,b,c){var d=new I,h=new I,e=new I,k=b.e,f=b.t,l=b.h(),n=m,v=m;a.add("(function(").add(f).add("){").add(d).add(h).add("(function(").add(f).add("){").add(l).add(e).add("})(").add(f).add(");");c?a.add("})(").add(f).add(");"):(b.i("global")||a.add("return "+F),b.i("escapexss")&&k.put(Ua,b.d.ka()),a.add("})(").add(b.r).add(");"),k.put(Ya,b.d.na()).put(F,b.i("global")?"(function(){return this})()":"{}").put(Wa,b.d.ma()));this.execute=function(a,b){var c;a.c()&&!n&&g("Space isn't allowed before a namespace.");
if(0!==a.length()){if("{"===a.charAt(0))if(n){if("{"===a.charAt(0))switch(a.charAt(1)){case "i":v&&g("ImportStatements must appear before GlobalVariableStatements and GlobalStatements.");c=new I;h.add(c);b.a(new pb(c));return;case "v":v&&g("GlobalVariableDeclarations must appear before GlobalStatements.");v=j;b.a(new qb);return;case "t":v=j;b.a(new rb(e));return}}else{"n"!==a.charAt(1)&&g("The first Production must be a ProgramNamespace.");n=j;b.a(new sb(d));return}g("Unknown characters: "+a.charAt(0)+
a.charAt(1))}};this.close=function(){n||g("No ProgramNamespace was declared.");v||g("Global Statements must appear before exiting Program.")}}t(ob,J);ob.prototype.name="Program";
function sb(a){this.execute=function(b,c){var d;if("{"===b.charAt(0))if(d=b.match(xa)){if(b.shift(d[1].length),d=b.match(fa)){d=d[1];b.shift(d.length);y(d);c.Z(d);d=d.split(".");var h="",e;a.add("var "+B+"="+F+";");var k=d.length,f;for(f=0;f<k;f++)h=d[f],e=e?e+("."+h):h,c.Z(e),a.add(B+"="+B+"."+h+"||("+B+"."+h+"={});");if("}"===b.charAt(0)){b.shift(1);c.b();return}g("Invalid character found after namespace value.")}}else g("NameSpace wasn't valid.");g("Unknown Character: '"+b.charAt(0))}}t(sb,J);
sb.prototype.name="ProgramNamespace";function pb(a){this.execute=function(b,c){b.c();"{"===b.charAt(0)&&"i"===b.charAt(1)?c.a(new tb(a)):c.b()}}t(pb,J);pb.prototype.name="ImportStatements";function tb(a){this.execute=function(b,c){var d=b.match(va);if(d)if(b.shift(d[1].length),d=b.match(da)){if(d=d[1],b.shift(d.length).c(),"}"===b.charAt(0)){b.shift(1);a.add(c.ra(d));c.b();return}}else g("Invalid import path given");g("No statement found.")}}t(tb,J);tb.prototype.name="ImportStatement";
function qb(){this.execute=function(a,b){a.c();"{"===a.charAt(0)&&"v"===a.charAt(1)?b.a(new Q(b.h())):b.b()}}t(qb,J);qb.prototype.name="GlobalVariableDeclarations";function Q(a){this.j=function(){return a};this.o=function(b){a.add(b,"")}}t(Q,N);Q.prototype.name="GlobalVariableDeclaration";Q.prototype.p=function(){return x};Q.prototype.q=function(a){return new ub(a)};Q.prototype.n=p();function ub(a){this.getExpression=function(){return new vb(a)}}t(ub,K);ub.prototype.name="GlobalVariableAssignment";
function wb(a){this.execute=function(b,c){b.c();var d;switch(b.charAt(0)){case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":d=Ka;break;case "@":b.shift(1);var h=b.match(u);if(h){d=h[1];c.L(d);b.shift(d.length);a.add("__"+d);c.b();return}break;case "'":case '"':d=Ma;break;case "n":d=La;break;case "t":case "f":d=Ja}if(d&&(d=b.match(d))){d=d[1];b.shift(d.length);a.add(d);c.b();return}g("Invalid value.")}}t(wb,J);wb.prototype.name="GlobalVariableValue";
function vb(a){this.f=function(){return a};this.H=function(){return new wb(a)};this.G=function(a){return new xb(a)}}t(vb,M);vb.prototype.name="GlobalExpression";function xb(a){this.getExpression=function(a){return new vb(a)};this.f=function(){return a}}t(xb,P);xb.prototype.name="GlobalParenthesizedExpression";
function rb(a){var b=m;this.execute=function(c,d){c.c();if(c.length())if("{"===c.charAt(0)){b=j;var h=new I;a.add(h);d.a(new yb(h))}else g("Invalid character found.");else d.b()};this.close=function(){b||g("No GlobalStatements were found.")}}t(rb,J);rb.prototype.name="GlobalStatements";
function yb(a){var b=m,c=m,d=m,h=new I;this.execute=function(e,k){var f;e.c();if("{"===e.charAt(0))if(b){if(d&&"v"===e.charAt(1)){k.a(new R(k.h()));d=m;c=j;return}if("/"===e.charAt(1)){if(f=e.match(Aa)){e.shift(f[1].length);k.b();k.Y();return}g("Template Declarations must be followed by '{/template}.")}if(c){c=m;k.a(new zb(h));return}}else{b=j;k.O();if(f=e.match(za)){e.shift(f[1].length);if(f=e.match(u)){f=f[1];e.shift(f.length);k.J(k.S()+"."+f);a.add(B+"."+f+"=function("+Pa+", "+Sa+"){var "+A+"="+
Pa+"||{},"+Ra+"="+Sa+"||{},"+z+"="+Ya+"(),"+C+"=''/0,"+Qa+"='',"+Ta+"="+C+";").add(k.h()).add(h).add("return "+z+".s()");a.add("};");if("}"===e.charAt(0)){e.shift(1);k.a(new S(k.h()));c=d=j;return}g("A closing curly must immediately follow a template name.")}g("Templates must have a name")}g("Only Templates are allowed in this context.")}else if(c){c=m;k.a(new zb(h));return}g("Invalid character?")}}t(yb,J);yb.prototype.name="TemplateDeclaration";
function zb(a){this.execute=function(b,c){"{"===b.charAt(0)&&"/"===b.charAt(1)?c.b():c.a(new T(a))}}t(zb,J);zb.prototype.name="TemplateBody";
function T(a){this.execute=function(b,c){var d;(d=b.match(la))&&b.shift(d[1].length);if("{"===b.charAt(0)){switch(b.charAt(1)){case ":":c.b().da(b);return;case "/":c.b();return;case "v":(d=b.match(x))&&g("VariableDeclarations are not allowed in this context.");break;case "p":(d=b.match(w))&&g("ParamDeclarations are not allowed in this context.");break;case "i":if(d=b.match(ta)){b.shift(d[1].length);d=new I;c.a(new U(d));a.add(d);return}break;case "l":if(d=b.match(wa)){b.shift(d[1].length);d=new I;
c.a(new Ab(d,c));a.add(d);return}break;case "c":if(d=b.match(pa)){b.shift(d[1].length);d=new I;c.a(new Bb(d));a.add(d);return}break;case "f":if(d=b.match(ra)){b.shift(d[1].length);d=new I;c.a(new Cb(d,c));a.add(d);return}break;case "t":if(d=b.match(Ba)){b.shift(d[1].length);d=new I;c.a(new Db(d));a.add(d);return}}d=new I;a.add(d);c.a(new Eb(d))}else d=new I,a.add(d),c.a(new Fb(d))}}t(T,J);T.prototype.name="TemplateBodyStatements";function S(a){this.D=function(){return new V(a)}}t(S,O);
S.prototype.name="ParamDeclarations";S.prototype.u="p";S.prototype.F=function(){return w};function V(a){this.j=function(){return a};this.o=function(b){a.add(b,Ra+"."+b)}}t(V,N);V.prototype.p=function(){return w};V.prototype.q=function(a){return new W(a)};V.prototype.n=function(a,b){b.add(Ra+"."+a+"||")};function R(a){this.D=function(){return new X(a)}}t(R,O);R.prototype.name="VariableDeclarations";R.prototype.u="v";R.prototype.F=function(){return x};
function X(a){this.j=function(){return a};this.o=function(b){a.add(b,"")}}t(X,N);X.prototype.name="VariableDeclaration";X.prototype.p=function(){return x};X.prototype.q=function(a){return new W(a)};X.prototype.n=p();function W(a){this.getExpression=function(){return new Y(a)}}t(W,K);W.prototype.name="AbstractAssignment";function Y(a){this.f=function(){return a};this.H=function(){return new Gb(a,m)}}t(Y,M);Y.prototype.name="VariableExpression";Y.prototype.G=function(a){return new Hb(a)};
function Hb(a){this.getExpression=function(a){return new Y(a)};this.f=function(){return a}}t(Hb,P);Hb.prototype.name="VariableParenthesizedExpression";
function Gb(a,b){function c(b,c){h||(h=new wb(a));h.execute(b,c)}var d=m,h;this.execute=function(e,h){var f;e.c();if(d){if(")"===e.charAt(0)){e.shift(1);a.add(")");h.b();return}g("Expecting close paren.")}switch(e.charAt(0)){case ")":g("Unexpected close paren.");case "@":if(f=e.match(na)){h.L(f[1]);break}case "'":case '"':case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":c(e,h);return;case "p":if(f=e.match(Ia)){e.shift(f[1].length);a.add(Ta);h.b();return}break;
case "c":if(f=e.match(Ea)){d=j;var l=new I;e.shift(f[1].length);a.add(G).add("(").add(l);h.a(new Z(l,b));h.e.put(G,h.d.ja());return}break;case "l":if(f=e.match(Ga)){e.shift(f[1].length);a.add(C);h.b();return}break;case "n":if(f=e.match(La)){c(e,h);return}if(f=e.match(Ha)){e.shift(f[1].length);a.add(Qa);h.b();return}break;case "t":case "f":if(f=e.match(Ja)){c(e,h);return}}h.b();h.a(new Z(a,b))}}t(Gb,J);Gb.prototype.name="VariableValue";
function Z(a,b){var c,d=m,h=j,e=j,k=j,f=j,l=m;b?c=a:(c=new I,a.add(Wa+"(function(){return ").add(c).add("})"));this.execute=function(a,b){var r,q;if(!l){a.c();q=a.charAt(0);switch(q){case "@":(r=a.match(oa))?(a.shift(r[1].length),b.L(r[2]),c.add(b.h().qa()+r[2]),e=m):g("invalid variable reference.");d=j;break;case "c":if(r=a.match(Fa))a.shift(r[1].length),e=m;d=j;break;case ".":a.shift(1),k=m,d=j}"@"!==q&&c.add(A);l=j}a.c();switch(a.charAt(0)){case ".":k||g("Unexpected '.'.");e=j;d=f=k=h=m;a.shift(1);
c.add(".");break;case "[":f||g("Unexpected '['.");e=m;d=k=f=j;b.a(new Ib(c));return}a.c();(q=a.match(fa))?(q=q[1],y(q),a.shift(q.length),h&&c.add("."),c.add(q),q=j):q=m;h=j;q?(e||g("unexpected name."),e=m,d=j):(d||g("Unexpected character."),b.b())}}t(Z,J);Z.prototype.name="ContextSelector";
function Ib(a){var b=m;this.execute=function(c,d){var h;c.c();switch(c.charAt(0)){case "[":if(!b){b=j;c.shift(1);h=new I;a.add("[").add(h);d.a(new Jb(h,j));return}break;case "]":if(b){b=m;c.shift(1);a.add("]");d.b();return}}g("Unexpected character: '"+c.charAt(0)+"'.")}}t(Ib,J);Ib.prototype.name="ContextDynamicRefinement";function Jb(a,b){this.f=function(){return a};this.H=function(){return new Gb(a,b)};this.G=function(a){return new Kb(a)}}t(Jb,M);Jb.prototype.name="ContextExpression";
function Kb(a){this.getExpression=function(a){return new Jb(a,j)};this.f=function(){return a}}t(Kb,P);Kb.prototype.name="ContextParenthesizedExpression";function Fb(a){this.execute=function(b,c){var d=b.match(ea);d?(d=d[1],b.shift(d.length),c.i("normalizespace")&&(d=d.replace(/\s+/g," ")),c.i("minifyhtml")&&(d=d.replace(ka,"$1$2")),d=d.replace(/\\{/g,"{").replace(/\\#/g,"#").replace(/\n|\r/g,"\\\n"),a.add(z+"('"+d+"');"),c.b()):g("Invalid Character found.")}}t(Fb,J);Fb.prototype.name="InputTokens";
function Eb(a){var b=m;this.execute=function(c,d){var h;switch(c.charAt(0)){case "{":if(!b){b=j;h=new I;c.shift(1);a.add(z+"(");d.i("escapexss")?a.add(Ua+"(").add(h).add(")"):a.add(h);a.add(");");d.a(new Y(h));return}break;case "}":if(b){c.shift(1);d.b();return}}g("Invalid Character.")}}t(Eb,J);Eb.prototype.name="PrintStatement";
function U(a){var b=new I,c=j,d=new I;a.add("if(").add(b).add("){").add(d).add("}");this.I=function(){return new Y(b)};this.B=function(){return new T(d)};this.Q=function(b,d){var k,f=new I;c||g("Continuations are not allowed after {:else}");b.ta()?(c=m,b.shift(7),a.add("else{").add(f).add("}"),d.a(new T(f))):(k=b.match(Da))?(b.shift(k[1].length),a.add("else ").add(f),d.b().a(new U(f))):g("Unknown continuation.")}}t(U,L);U.prototype.name="IfStatement";U.prototype.C=function(){return ua};
function Ab(a,b){var c=new I,d=m;b.i("removelogs")||a.add("console.log(").add(c).add(");");this.execute=function(a,b){a.c();d?"}"===a.charAt(0)?(a.shift(1),b.b()):g("Invalid character."):(d=j,b.a(new Y(c)))}}t(Ab,J);Ab.prototype.name="LogStatement";function Bb(a){var b=new I,c=new I,d=new I;this.M=j;a.add(z).add("(").add(b).add("(").add(c).add(d).add(")").add(");");this.I=function(){return new Lb(b,c)};this.B=function(){return new $(d)}}t(Bb,L);Bb.prototype.C=function(){return qa};
Bb.prototype.name="CallStatement";function $(a){var b=new fb(",{","",":","}",null),c=j;this.j=function(){return b};this.D=function(){c&&(c=m,a.add(b));return new Mb(b)}}t($,O);$.prototype.name="CallParams";$.prototype.u="p";$.prototype.F=function(){return w};function Mb(a){this.j=function(){return a}}t(Mb,N);s=Mb.prototype;s.name="CallParamDeclaration";s.p=function(){return w};s.q=function(a){return new W(a)};s.n=p();s.o=function(){g("An assignment must be made here.")};
function Lb(a,b){var c=m;this.execute=function(d,h){var e;if(!c){if(e=d.match(ga))c=j,e=e[1],d.shift(e.length),a.add(F+"."+e),h.A(e);else if(e=d.match(u))c=j,e=e[1],d.shift(e.length),a.add(B+"."+e),h.A(h.S()+"."+e);if(c){h.b();d.c();e=d.charAt(0);"/"!==e&&"}"!==e?h.a(new Z(b,m)):b.add(A);return}g("A valid Namespace must be given.")}g("Invalid Character")}}t(Lb,J);Lb.prototype.name="CallExpression";
function Db(a){this.execute=function(b,c){var d;if(d=b.match(ma))d=d[1],b.shift(d.length),a.add(z+"('"+d.replace("\\","\\\\").replace(/\r?\n/g,"\\\n").replace("'","\\'")+"');");(d=b.match(Ca))?(b.shift(d[1].length),c.b()):g("Unexpected character.")}}t(Db,J);Db.prototype.name="TextStatement";
function Cb(a,b){var c=new I,d=new I,h=new I,e=new I;a.add(Va+"(").add(H+"(").add(c).add(e).add(")").add(",").add("function("+A+","+Ta+","+C+","+Qa+"){").add(d).add("}").add(h).add(");");b.e.put(Va,b.d.la()).put(H,b.d.R());this.I=function(){return new Z(c,m)};this.B=function(){return new Nb(d,e,h)}}t(Cb,L);Cb.prototype.name="ForeachStatement";Cb.prototype.C=function(){return sa};
function Nb(a,b,c){var d=m,h=m,e=m,k=m;this.execute=function(f,l){var n;f.c();k||(k=j,l.O());switch(f.charAt(0)){case "{":switch(f.charAt(1)){case "s":if(!d&&(!h&&!e)&&(d=j,n=f.match(ya))){f.shift(n[1].length);l.a(new Ob(b,c,l));return}break;case "v":if(!h&&!e&&(h=j,n=f.match(x))){a.add(l.h());l.a(new R(l.h()));return}break;case "/":l.b();l.Y();return}default:e=j,l.a(new T(a))}}}t(Nb,J);Nb.prototype.name="ForeachBodyStatements";
function Ob(a,b,c){c.e.put(H,c.d.R());var d=m,h=m;this.execute=function(c,k){c.c();if(d){if(!h){var f=c.match(ha);if(f){h=j;var l=f[1];c.shift(l.length);var f=0,n=m,v=0,r=0;switch(l){case "|asc":f=0;break;case "|desc":f=1;break;case "|rand":f=2}if(l=c.match(ia))2===f&&g("Modifiers are not allowed after |rand"),l=l[1],c.shift(l.length),-1<l.indexOf("i")&&(r=1,/i[^i]*?i/i.test(l)&&g("'i' may only appear once in sort options.")),(n=-1<l.indexOf("n"))&&/n[^n]*?n/i.test(l)&&g("'n' may only appear once in sort options."),
-1<l.indexOf("c")?v=1:-1<l.indexOf("C")&&(v=2),v&&/c[^c]*?c/i.test(l)&&g("Only one of 'c' or 'C' may appear in sort options.");b.add(","+f+","+(n?1:0)+","+v+","+r)}else g("Sort direction must be one of '|asc', '|desc' or '|rand'.")}h||g("One of '|asc', '|desc' or '|rand' is required.");"}"===c.charAt(0)?(c.shift(1),k.b()):g("Invalid Character.")}else d=j,f=new I,a.add(",function("+A+"){return ").add(f).add("}"),k.a(new Z(f,j))}}t(Ob,J);Ob.prototype.name="SortStatement";
function mb(){var a={},b={};this.J=function(b){a[b]=j;return this};this.A=function(a){b[a]=j;return this};this.T=function(a){return b.hasOwnProperty(a)};this.U=function(b){return a.hasOwnProperty(b)};this.ua=function(){for(var c in b)a.hasOwnProperty(c)||g(c+" has not been declared.")}}
function aa(a){a=a||{};var b={debug:m,escapexss:j,global:j,minifyhtml:j,normalizespace:j,outputlibrary:"",removelogs:j,useexternal:m,warn:m},c;for(c in a)c in b&&(b[c]=a[c]);this.ca=b;this.d=new jb(b);this.compile=function(a,b,c){(!a||"string"!==typeof a)&&g("input must be a string.");var k=new I;a=new kb(a);var f=new lb(k,this,c);b&&f.sa(b);try{for(f.a(new ob(k,f,!!c));0<a.length();)f.ea(a);f.close()}catch(l){g("=========================\n"+f.ia().name+":\n-------------------------\n"+l+"\n\n   Line       : "+
a.oa()+"\n   Column     : "+a.ha()+"\n=========================\n")}return k.toString()}}this.XforJS=ca;}();
