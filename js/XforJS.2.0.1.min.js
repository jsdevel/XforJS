!function(){/*

 Copyright 2012 Joseph Spencer.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Version: 2.0.1

 For demos and docs visit http://jsdevel.github.com/XforJS/
 For viewing source visit http://github.com/jsdevel/XforJS/
*/
function g(a){throw a;}var j=!0,m=!1;function p(){return function(){}}
var r,s={server:m,getCompiler:function(a){return new ba(a)},getLib:function(a){return ca(a)},buildOutputLibrary:function(a,b){var c,d;if(s.Ca)try{c=require("fs"),c.existsSync(a)&&c.statSync(a).isDirectory()&&g("Can't overwrite the following directory with the library: "+a),d=ca(b),c.writeFileSync(a,d)}catch(e){g("The following happened while attempting to write to '"+a+"':\n"+e)}else g("Unable to output library in a non-server environment.  Configure XforJS.server=true;");return this}};
function t(a,b){a.prototype=new b;a.prototype.constructor=a}
var da=/^((?:[^\}\\]|\\[\}\\])+\.xjs)/,ea=/^((?:\\[#\{]|(?![#\{])[\s\S])+)/,w=/^([a-zA-Z$_](?:[\w$]+)?)/,x=/^([a-zA-Z$_](?:[\w$]+)?(?:(?:\.[a-zA-Z$_](?:[\w$]+)?)+)?)/,fa=/^([a-zA-Z$_](?:[\w$]+)?(?:\.[a-zA-Z$_](?:[\w$]+)?)+)/,ga=/^([!~]+)/,ha=/^(typeof)(?=[\(\s])/,ia=/^(\|)(?!\|)/,ja=/^(\|[eE]{1,2})(?=\})/,ka=/^(\|(?:asc|desc|rand))(?![\w$])/,la=/^(\|[cCin]{1,4})(?![\w$])/,ma=/^((?:\s+|#(?:[^\r\n]+)?(?:\r?\n))+)/,na=/(>|<)\s+|\s+(>|<)/g,oa=/^((?:\s+(?=\{)|#(?:[^\r\n]+)?(?:\r?\n))+)/,pa=/^((?:(?!\{\/text\})[\s\S])+)(?=\{\/text\})/,
qa=/^@([a-zA-Z$_](?:[\w$]+)?)\s*[\.\[\(]/,ra=/^(@([a-zA-Z$_](?:[\w$]+)?))/,sa=/^(\{render\s+)/,ta=/^(\{\/render\})/,ua=/^(\{foreach\s+)/,va=/^(\{\/foreach\})/,wa=/^(\{if\s+)/,xa=/^(\{\/if\})/,ya=/^(\{import\s+)/,za=/^(\{log\s+)/,Aa=/^(\{namespace\s+)/,y=/^(\{param\s+)/,Ba=/^(\{sort\s+)/,Ca=/^(\{template\s+)/,Da=/^(\{\/template\})/,Ea=/^(\{text\})/,Fa=/^(\{\/text\})/,z=/^(\{var\s+)/,Ga=/^(\{:elif\s+)/,Ha=/^(count\()/,Ia=/^(current\(\))/,Ja=/^(last\(\))/,Ka=/^(name\(\))/,La=/^(position\(\))/,Oa=/^(false|true)(?![\w$])/,
Pa=/^((?:0x(?=([0-9A-Fa-f]+))\2(?!\.)|(?=(0(?![0-9])|[1-9][0-9]*))\3(?!x)(?:\.[0-9]+)?)(?:[eE][-+][0-9]+)?)/,Qa=/^(null)(?![\w$])/,Ra=/^((['"])(?=((?:(?:(?!\2|\r?\n|\\)[\s\S]|\\(?:\\|\2|\r?\n))+)?))\3\2)/,Sa={"break":j,"case":j,"catch":j,"continue":j,"debugger":j,"default":j,"delete":j,"do":j,"else":j,"finally":j,"for":j,"function":j,"if":j,"in":j,"instanceof":j,"new":j,"return":j,"switch":j,"this":j,"throw":j,"try":j,"typeof":j,"var":j,"void":j,"while":j,"with":j,"class":j,"const":j,"enum":j,"export":j,
"extends":j,"import":j,"super":j,"implements":j,"interface":j,let:j,"package":j,"private":j,"protected":j,"public":j,"static":j,yield:j};function A(a){var b=a.split("."),c=0,d=b.length;for((!a||!x.test(a))&&g("Invalid namespace given: '"+a+"'.");c<d;c++)Sa[b[c]]&&g("Usage of the following ECMAScript reserved word is not allowed: "+b[c])}
function Ta(a){var b=require("fs"),c=require("path");(!a||"string"!==typeof a)&&g("inputFilePath must be a string.");a=c.normalize(a.replace(/^\s+|\s+$/g,""));/\.xjs$/.test(a)||g("\ninputFilePath must end with '.xjs'.\nAlso be sure to supply an abslolute path.");b.existsSync(a)||g("The following path doesn't exist: \n   "+a);return c.resolve(a)}function Ua(a){var b,c=0,d;try{b=a()}catch(e){b=a}if(b&&"object"===typeof b){if(b.slice&&b.join&&b.pop)return b.length>>>0;for(d in b)c++}return c}
function Va(a){return"string"===typeof a?a.replace(/&(?![a-zA-Z]+;|#[0-9]+;)/g,"&amp;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/&(?![a-zA-Z]+;|#[0-9]+;)/g,"&#96;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):a}function Wa(a,b){var c,d,e;if(a instanceof Array&&"function"===typeof b){d=a.length;for(c=0;c<d;c++)e=a[c],b(e.L,c+1,d,e.W)}}
function ca(a){var b="XforJS.js";void 0!==a&&(b=a,A(b));return'/**\n * @preserve\n * Copyright 2012 Joseph Spencer.\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * Version: 2.0.1\n *\n * For demos and docs visit http://jsdevel.github.com/XforJS/\n * For viewing source visit http://github.com/jsdevel/XforJS/\n */\n'+b+
"={\nC:"+Ua.toString()+",\nX:"+Va.toString()+",\ne:"+Wa.toString()+",\nV:"+Xa.toString()+",\ng:"+Ya.toString()+",\ns:"+Za.toString()+",\nS:"+$a.toString()+"\n};"}function Ya(a){var b=[],c,d;try{d=a()}catch(e){d=a}if(d&&"object"===typeof d)for(c in d)b.push({W:c,L:d[c]});return b}
function Za(a,b,c,d,e,f){function k(a,b){var c=a.$,h=b.$,k=a.V,v=b.V,l=k[0]!==c[0],q=v[0]!==h[0],u=a.Z,aa=b.Z,Ma="number"===u,Na="number"===aa;if(c===h)return 0;if(Ma!==Na)return d?u>aa?1:0:u>aa?0:1;if(Ma&&Na)return n?c>h?1:0:c>h?0:1;if(!k&&!v)return 0;if(!k&&v)return 1;if(k&&!v)return 0;switch(e){case 0:return n?f?k>v?1:0:c>h?1:0:f?k===v?0:k>v?0:1:l&&!q?0:!l&&q?1:c>h?0:1;case 1:return n?f?k===v?l&&!q?1:0:k>v?1:-1:l&&!q?1:!l&&q?0:c>h?1:-1:f?k===v?l&&!q?1:-1:k>v?-1:1:l&&q||!l&&!q?c>h?-1:1:l?1:-1;case 2:return n?
f?k===v?l&&!q?-1:!l&&q?1:0:k>v?1:-1:l&&q||!l&&!q?c>h?1:-1:l?-1:1:f?k===v?l&&!q?-1:!l&&q?1:0:k>v?-1:1:l&&q||!l&&!q?c>h?-1:1:l?-1:1}}var h,n=0===c,l,q,u;h=a.length;if(1<c){b=[];h=0;for(q=a.length;h<q;h++)c=~~(Math.random()*(b.length+1)),b.splice(c,0,a[h]);return b}for(c=0;c<h;c++){l=a[c];try{q=b(l.L,l.W)}catch(v){q=l.L}u=typeof q;l.V="string"===u?q.toLowerCase():"";l.Z=u;l.$="string"===u||"number"===u?q:""}b=a.length;h=b*b;q=0;c=1;l=c-1;for(u=0;c<b&&!(q>h);c++)q++,1===k(a[c-1],a[c])?(a.splice(c,0,a.splice(c-
1,1)[0]),c-=2,0>c&&(c=0),u=1):u?(u=0,c=l):l++;return a}function Xa(a){try{return a()}catch(b){return"function"===typeof a?void 0:a}}function $a(){function a(a){var e;try{e=a()}catch(f){e=a}b[c++]=-1<"number string boolean".indexOf(typeof e)?e:""}var b=[],c=0;a.s=function(){return b.join("")};return a}
function B(){var a=[],b=[],c=[];this.add=function(b){a.push(b);return this};this.append=function(a){c.push(a);return this};this.sa=function(){b.unshift("s(");return this};this.toString=function(){return b.join("")+a.join("")+c.join("")}}
function ab(a,b,c,d,e){var f={},k=[],h=[],n=b||"";"string"!==typeof a&&g("Prefix is required.");"string"!==typeof c&&g("Seperator is required.");"string"!==typeof d&&g("Postfix is required");this.add=function(a,b){var c=n+a;f.hasOwnProperty(c)&&g("The following has been declared twice: "+a);b&&"object"===typeof b||"string"===typeof b||g('Null value was discovered for the following: "'+a+'"');f[c]=b;k.push(c);return this};this.U=function(a){return f.hasOwnProperty(n+a)||e&&e.U(a)?j:m};this.qa=function(){return n};
this.toString=function(){var b,e,n=0;if(0<k.length){b=k.shift();e=f[b].toString();h.push(a+b);""!==e&&h.push(c+e);for(b=k.length;n<b;n++)e=k[n],h.push(","+e),e=f[e],e.toString()&&h.push(c+e);h.push(d)}return h.join("")}}function bb(){var a=[],b=[],c={};this.put=function(d,e){!c.hasOwnProperty(d)&&(d&&e)&&(a.push(d),b.push(e),c[d]=j);return this};this.pa=function(){return a.join(",")};this.da=function(){return b.join(",")}}function cb(a){this.toString=function(){return a.pa()}}
function db(a){this.toString=function(){return a.da()}}
function eb(a){var b,c,d,e,f,k,h,n=a.libnamespace;(!a||"object"!==typeof a)&&g("args must be an object.");a.useexternal?(n?A(n):n="XforJS.js",b=n+".C",c=n+".X",d=n+".e",e=n+".V",f=n+".g",k=n+".s",h=n+".S"):(b=Ua.toString(),c=Va.toString(),d=Wa.toString(),e=Xa.toString(),f=Ya.toString(),k=Za.toString(),h=$a.toString());this.ha=function(){return b};this.ja=function(){return c};this.ia=function(){return d};this.la=function(){return e};this.ka=function(){return f};this.ma=function(){return k};this.na=
function(){return h}}
function fb(a){var b="string"===typeof a&&a||"",c=1,d=1;this.length=function(){return b.length};this.charAt=function(a){a=a||0;a>=b.length&&g("There are no more characters to parse.");return b[a]};this.shift=function(a){var f=0,k;if(-1<b.length-~~a){for(f=0;f<a;f++)switch(k=b[f],k){case "\r":"\n"===b[f+1]&&f++;case "\n":c++;d=1;continue;default:d++}b=b.slice(a)}else g("Can't shift.  Nothing left to parse.");return this};this.match=function(a){return a.exec(b)};this.c=function(){var a=ma.exec(b);return a?
(this.shift(a[1].length),j):m};this.ta=function(){var a=oa.exec(b);a&&this.shift(a[1].length)};this.va=function(){return 0===b.indexOf("{:else}")};this.oa=function(){return c};this.fa=function(){return d};this.toString=function(){return b}}function C(){}C.prototype.execute=p();C.prototype.Q=function(){g("Block continuations are not allowed here.")};C.prototype.close=function(){g('Unable to close: "'+this.constructor.name+'"')};C.prototype.name="Production";
function gb(a,b,c){a instanceof B||g("output must be of type Output.");b instanceof ba||g("compiler must be of type Compiler.");c&&!(c instanceof gb)&&g("previousContext must be of type ProductionContext.");var d=new ab("var ","__","=",";",void 0),e=[d],f,k=[],h,n,l;c?(this.v=c.v,this.e=c.e,this.t=c.t,this.r=c.r,this.z=c.z,this.k=c.k,this.d=c.d,this.J=c.J,l=c.ea()):(this.v={},this.e=new bb,this.t=new cb(this.e),this.r=new db(this.e),this.z={},this.k=b.aa,this.d=b.d,l=new hb);var q=this.k,u=[q];this.Da=
function(a){var b;if(a&&"object"===typeof a){for(b in q)a.hasOwnProperty(b)||(a[b]=q[b]);u.push(a);this.k=q=a}else g("obj must be an object.");return this};this.i=function(a){return q[a]};this.Ba=function(){1<u.length?(u.pop(),this.k=q=u[u.length-1]):g("Can't remove default configuration.");return this};this.za=function(){return this.e};this.ya=function(){return this.t};this.xa=function(){return this.r};this.Y=function(a){a||g("invalid namespace given.");h||(h=a);this.v[a]=j};this.R=function(){h||
g("no namespace has been declared.");return h||""};this.Aa=function(a){return this.v[a]};this.ua=function(a){n&&g("can't set path more than once.");n=Ta(a)};this.ra=function(a){n||g("\n\\nCan't import '"+a+"' because no inputFilePath was given to the ProductionContext.\nHave you supplied '"+a+"' to the compile method?");var c=require("path"),d=require("fs"),f=c.dirname(n);a=Ta(c.resolve(f,a));if(this.z[a])return"";this.z[a]=j;d=d.readFileSync(a,"utf8");return b.compile(d,a,this)};this.a=function(a){k.push(a);
f=a};this.b=function(){k.length||g("There is no production to remove from context.");k.pop();f=k[k.length-1];return this};this.ca=function(a){f.execute(a,this)};this.ba=function(a){f.Q(a,this)};this.ga=function(){return f};this.h=function(){return d};this.P=function(){var a=new ab("var ","__","=",";",d);d=a;e.push(a)};this.X=function(){var a=e.length;1<a?(e.pop(),d=e[a-2]):g("Illegal attempt to remove VariableOutput.")};this.M=function(a){d.U(a)||g('Variable "'+a+"\" hasn't been declared yet.")};
this.ea=function(){return l};this.K=function(a){l.K(a);return this};this.A=function(a){l.A(a);return this};this.S=function(a){return l.S(a)};this.T=function(a){return l.T(a)};this.close=function(){var a=k.length,b=a-1;if(a)for(;-1<b;b--)k[b].close(this);else g("No productions were found.");l.wa()}}gb.prototype.J=m;function D(){}t(D,C);D.prototype.name="AbstractAssignment";D.prototype.execute=function(a,b){this.l?b.b():(this.l=j,b.a(this.getExpression()))};D.prototype.getExpression=p();
function E(){}t(E,C);r=E.prototype;r.name="AbstractConditionBlock";r.N=m;r.O=j;r.w=j;r.B=p();r.C=p();r.I=p();r.execute=function(a,b){var c;if(this.O)b.a(this.I()),this.O=m;else{a.c();switch(a.charAt(0)){case "/":if(this.w&&this.N&&"}"===a.charAt(1)){a.shift(2);b.b();return}g("Unexpected '/'");case "}":if(this.w){a.shift(1);this.w=m;b.a(this.B());return}break;case "{":if(!this.w&&"/"===a.charAt(1)&&(c=a.match(this.C()))){a.shift(c[1].length);b.b();return}}g("Invalid Expression found.")}};
function F(){}t(F,C);r=F.prototype;r.name="AbstractExpression";r.m=m;r.g=m;
r.execute=function(a,b){var c=this.f();a.c();if("}"!==a.charAt(0)){if(this.g===m||this.m){this.m=m;this.g=j;var d;switch(a.charAt(0)){case "!":case "~":d=a.match(ga);d=d[1];a.shift(d.length);a.c();c.add(d);break;case "t":if(d=a.match(ha))a.shift(d[1].length),c.add("typeof"),a.c(),"("!==a.charAt(0)&&c.add(" ")}"("===a.charAt(0)?(a.shift(1),d=new B,c.add(d),b.a(this.G(d))):b.a(this.H());return}if(this.g&&!a.match(ia))switch(a.charAt(0)){case ",":case "]":case ")":break;default:this.m=j;this.g=m;b.a(new ib(c));
return}}this.g&&!this.m?b.b():(this.m&&g("Unclosed Operator."),g("Empty Expression."))};r.H=p();r.G=p();r.f=p();function G(){}t(G,C);r=G.prototype;r.name="AbstractVariableDeclaration";
r.execute=function(a,b){a.c();if(!this.g){this.g=j;var c=a.match(this.p());if(c)if(a.shift(c[1].length),a.c(),c=a.match(w)){c=c[1];a.shift(c.length);if(a.c()){var d=new B;this.n(c,d);this.j().add(c,d);b.a(this.q(d));return}this.o(c,b)}else g("No valid name was found.");else g("Invalid start tag.")}this.g&&"}"===a.charAt(0)?(a.shift(1),b.b()):g("Invalid character found.")};r.p=p();r.j=p();r.q=p();r.n=p();r.o=p();
function H(){this.execute=function(a,b){a.c();"{"===a.charAt(0)&&a.charAt(1)===this.u&&a.match(this.F())?b.a(this.D()):b.b()}}t(H,C);H.prototype.name="AbstractVariableDeclarations";H.prototype.u="";H.prototype.D=p();H.prototype.F=p();
function I(){this.execute=function(a,b){a.c();switch(a.charAt(0)){case ")":this.l||g("Empty Expressions are not allowed.");a.shift(1);b.b();return;default:if(!this.l){this.l=j;var c=new B;this.f().add("(").add(c).add(")");b.a(this.getExpression(c));return}}g("Possibly an unclosed paren was found.")}}t(I,C);I.prototype.l=m;I.prototype.getExpression=p();I.prototype.f=p();
function ib(a){this.execute=function(b,c){var d="";b.c();switch(b.charAt(0)){case "=":if("="===b.charAt(1)){"="===b.charAt(2)?(b.shift(3),d="==="):(b.shift(2),d="==");a.add(d);c.b();return}break;case "!":if("="===b.charAt(1)){"="===b.charAt(2)?(b.shift(3),d="!=="):d="!=";a.add(d);c.b();return}break;case "|":if("|"===b.charAt(1)){b.shift(2);a.add("||");c.b();return}break;case "&":if("&"===b.charAt(1)){b.shift(2);a.add("&&");c.b();return}break;case "<":case ">":if("="===b.charAt(1)){a.add(b.charAt(0)+
"=");b.shift(2);c.b();return}case "+":case "-":case "%":case "*":case "/":a.add(b.charAt(0));b.shift(1);c.b();return}g("Invalid Operator.")}}t(ib,C);ib.prototype.name="Operator";
function jb(a,b,c){var d=new B,e=new B,f=new B,k=b.e,h=b.t,n=m,l=m;a.add("(function(").add(h).add("){").add(d).add(e).add("(function(").add(h).add("){").add(b.h()).add(f).add("})(").add(h).add(");");c?a.add("})(").add(h).add(");"):(b.i("global")||a.add("return B"),a.add("})(").add(b.r).add(");"),k.put("S",b.d.na()).put("B",b.i("global")?"(function(){return this})()":"{}").put("V",b.d.la()));this.execute=function(a,b){var c;a.c()&&!n&&g("Space isn't allowed before a namespace.");if(0!==a.length()){if("{"===
a.charAt(0))if(n){if("{"===a.charAt(0))switch(a.charAt(1)){case "i":l&&g("ImportStatements must appear before GlobalVariableStatements and GlobalStatements.");c=new B;e.add(c);b.a(new kb(c));return;case "v":l&&g("GlobalVariableDeclarations must appear before GlobalStatements.");l=j;b.a(new lb);return;case "t":l=j;b.a(new mb(f));return}}else{"n"!==a.charAt(1)&&g("The first Production must be a ProgramNamespace.");n=j;b.a(new nb(d));return}g("Unknown characters: "+a.charAt(0)+a.charAt(1))}};this.close=
function(){n||g("No ProgramNamespace was declared.");l||g("Global Statements must appear before exiting Program.")}}t(jb,C);jb.prototype.name="Program";
function nb(a){this.execute=function(b,c){var d;if("{"===b.charAt(0))if(d=b.match(Aa)){if(b.shift(d[1].length),d=b.match(x)){d=d[1];b.shift(d.length);A(d);c.Y(d);d=d.split(".");var e="",f;a.add("var N=B;");var k=d.length,h;for(h=0;h<k;h++)e=d[h],f=f?f+("."+e):e,c.Y(f),a.add("N=N."+e+"||(N."+e+"={});");if("}"===b.charAt(0)){b.shift(1);c.b();return}g("Invalid character found after namespace value.")}}else g("NameSpace wasn't valid.");g("Unknown Character: '"+b.charAt(0))}}t(nb,C);
nb.prototype.name="ProgramNamespace";function kb(a){this.execute=function(b,c){b.c();"{"===b.charAt(0)&&"i"===b.charAt(1)?c.a(new ob(a)):c.b()}}t(kb,C);kb.prototype.name="ImportStatements";function ob(a){this.execute=function(b,c){var d=b.match(ya);if(d)if(b.shift(d[1].length),d=b.match(da)){if(d=d[1],b.shift(d.length).c(),"}"===b.charAt(0)){b.shift(1);a.add(c.ra(d));c.b();return}}else g("Invalid import path given");g("No statement found.")}}t(ob,C);ob.prototype.name="ImportStatement";
function lb(){this.execute=function(a,b){a.c();"{"===a.charAt(0)&&"v"===a.charAt(1)?b.a(new J(b.h())):b.b()}}t(lb,C);lb.prototype.name="GlobalVariableDeclarations";function J(a){this.j=function(){return a};this.o=function(b){a.add(b,"")}}t(J,G);J.prototype.name="GlobalVariableDeclaration";J.prototype.p=function(){return z};J.prototype.q=function(a){return new pb(a)};J.prototype.n=p();function pb(a){this.getExpression=function(){return new K(a)}}t(pb,D);pb.prototype.name="GlobalVariableAssignment";
function L(a){this.execute=function(b,c){b.c();var d;switch(b.charAt(0)){case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":d=Pa;break;case "@":b.shift(1);var e=b.match(w);if(e){d=e[1];c.M(d);b.shift(d.length);a.add("__"+d);c.b();return}break;case "'":case '"':d=Ra;break;case "n":d=Qa;break;case "t":case "f":d=Oa}if(d&&(d=b.match(d))){d=d[1];b.shift(d.length);a.add(d);c.b();return}g("Invalid value.")}}t(L,C);L.prototype.name="GlobalVariableValue";
function K(a){this.f=function(){return a};this.H=function(){return new L(a)};this.G=function(a){return new qb(a)}}t(K,F);K.prototype.name="GlobalExpression";function qb(a){this.getExpression=function(a){return new K(a)};this.f=function(){return a}}t(qb,I);qb.prototype.name="GlobalParenthesizedExpression";
function mb(a){var b=m;this.execute=function(c,d){c.c();if(c.length())if("{"===c.charAt(0)){b=j;var e=new B;a.add(e);d.a(new rb(e))}else g("Invalid character found.");else d.b()};this.close=function(){b||g("No GlobalStatements were found.")}}t(mb,C);mb.prototype.name="GlobalStatements";
function rb(a){var b=m,c=m,d=m,e=new B;this.execute=function(f,k){var h;f.c();if("{"===f.charAt(0))if(b){if(d&&"v"===f.charAt(1)){k.a(new M(k.h()));d=m;c=j;return}if("/"===f.charAt(1)){if(h=f.match(Da)){f.shift(h[1].length);k.b();k.X();return}g("Template Declarations must be followed by '{/template}.")}if(c){c=m;k.a(new N(e));return}}else{b=j;k.P();if(h=f.match(Ca)){f.shift(h[1].length);if(h=f.match(w)){h=h[1];f.shift(h.length);k.K(k.R()+"."+h);a.add("N."+h+"=function(A, M){var x=A||{},P=M||{},b=S(),L=''/0,n='',O=L;").add(k.h()).add(e).add("return b.s()");
a.add("};");if("}"===f.charAt(0)){f.shift(1);k.a(new O(k.h()));c=d=j;return}g("A closing curly must immediately follow a template name.")}g("Templates must have a name")}g("Only Templates are allowed in this context.")}else if(c){c=m;k.a(new N(e));return}g("Invalid character?")}}t(rb,C);rb.prototype.name="TemplateDeclaration";function N(a){this.execute=function(b,c){"{"===b.charAt(0)&&"/"===b.charAt(1)?c.b():c.a(new P(a))}}t(N,C);N.prototype.name="TemplateBody";
function P(a){this.execute=function(b,c){var d;b.ta();if("{"===b.charAt(0)){switch(b.charAt(1)){case ":":c.b().ba(b);return;case "/":c.b();return;case "v":(d=b.match(z))&&g("VariableDeclarations are not allowed in this context.");break;case "p":(d=b.match(y))&&g("ParamDeclarations are not allowed in this context.");break;case "i":if(d=b.match(wa)){b.shift(d[1].length);d=new B;c.a(new Q(d));a.add(d);return}break;case "l":if(d=b.match(za)){b.shift(d[1].length);d=new B;c.a(new sb(d,c));a.add(d);return}break;
case "r":if(d=b.match(sa)){b.shift(d[1].length);d=new B;c.a(new R(d));a.add(d);return}break;case "f":if(d=b.match(ua)){b.shift(d[1].length);d=new B;c.a(new S(d,c));a.add(d);return}break;case "t":if(d=b.match(Ea)){b.shift(d[1].length);d=new B;c.a(new tb(d));a.add(d);return}}d=new B;a.add(d);c.a(new ub(d))}else d=new B,a.add(d),c.a(new vb(d))}}t(P,C);P.prototype.name="TemplateBodyStatements";function O(a){this.D=function(){return new T(a)}}t(O,H);O.prototype.name="ParamDeclarations";O.prototype.u="p";
O.prototype.F=function(){return y};function T(a){this.j=function(){return a};this.o=function(b){a.add(b,"P."+b)}}t(T,G);T.prototype.p=function(){return y};T.prototype.q=function(a){return new U(a)};T.prototype.n=function(a,b){b.add("P."+a+"||")};function M(a){this.D=function(){return new V(a)}}t(M,H);M.prototype.name="VariableDeclarations";M.prototype.u="v";M.prototype.F=function(){return z};function V(a){this.j=function(){return a};this.o=function(b){a.add(b,"")}}t(V,G);V.prototype.name="VariableDeclaration";
V.prototype.p=function(){return z};V.prototype.q=function(a){return new U(a)};V.prototype.n=p();function U(a){this.getExpression=function(){return new W(a)}}t(U,D);U.prototype.name="AbstractAssignment";function W(a){this.f=function(){return a};this.H=function(){return new X(a,m)}}t(W,F);W.prototype.name="VariableExpression";W.prototype.G=function(a){return new wb(a)};function wb(a){this.getExpression=function(a){return new W(a)};this.f=function(){return a}}t(wb,I);wb.prototype.name="VariableParenthesizedExpression";
function X(a,b){function c(b,c){e||(e=new L(a));e.execute(b,c)}var d=m,e;this.execute=function(f,e){var h;f.c();if(d){if(")"===f.charAt(0)){f.shift(1);a.add(")");e.b();return}g("Expecting close paren.")}switch(f.charAt(0)){case ")":g("Unexpected close paren.");case "@":if(h=f.match(qa)){e.M(h[1]);break}case "'":case '"':case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":c(f,e);return;case "p":if(h=f.match(La)){f.shift(h[1].length);a.add("O");e.b();return}break;
case "c":if(h=f.match(Ha)){d=j;var n=new B;f.shift(h[1].length);a.add("C").add("(").add(n);e.a(new Y(n,b));e.e.put("C",e.d.ha());return}break;case "l":if(h=f.match(Ja)){f.shift(h[1].length);a.add("L");e.b();return}break;case "n":if(h=f.match(Qa)){c(f,e);return}break;case "t":case "f":if(h=f.match(Oa)){c(f,e);return}}e.b();e.a(new Y(a,b))}}t(X,C);X.prototype.name="VariableValue";
function xb(a){var b=m,c=new B;a.add("(").add(c).add(")");this.execute=function(a,e){a.c();")"===a.charAt(0)?(a.shift(1),e.b()):(b&&g("Multiple Expressions not allowed here."),b=j,e.a(new yb(c)))}}t(xb,C);xb.prototype.name="CallExpression";
function yb(a){var b=m,c=m;this.execute=function(d,e){var f;d.c();")"===d.charAt(0)?(b&&g("Elision not allowed here."),e.b()):","===d.charAt(0)?((!c||b)&&g("Elision not allowed here."),c=m,b=j,d.shift(1),a.add(",")):(c&&g("Expected comma or close paren."),c=j,b=m,f=new B,a.add(f),e.a(new W(f)))}}t(yb,C);yb.prototype.name="CallArguments";
function Y(a,b){var c,d=m,e=j,f=j,k=j,h=j,n=m;c=b?a:new B;this.execute=function(l,q){var u,v;if(!n){l.c();v=l.charAt(0);switch(v){case "n":if(u=l.match(Ka)){l.shift(u[1].length);a.add("n");q.b();return}default:b||a.add("V(function(){return ").add(c).add("})")}switch(v){case "@":(u=l.match(ra))?(l.shift(u[1].length),q.M(u[2]),c.add(q.h().qa()+u[2]),f=m):g("invalid variable reference.");d=j;break;case "^":d=j;e=m;break;case "c":if(u=l.match(Ia))l.shift(u[1].length),f=m;d=j;break;case ".":l.shift(1),
k=m,d=j}"^"===v?l.shift(1):"@"!==v&&c.add("x");n=j}l.c();switch(l.charAt(0)){case "(":d||g("Cannot make a call on a non-existent item.");d=j;l.shift(1);q.a(new xb(c));return;case ".":k||g("Unexpected '.'.");f=j;d=h=k=e=m;l.shift(1);c.add(".");break;case "[":h||g("Unexpected '['.");f=m;d=k=h=j;q.a(new zb(c));return}l.c();(v=l.match(x))?(v=v[1],A(v),l.shift(v.length),e&&c.add("."),c.add(v),v=j):v=m;e=j;v?(f||g("unexpected name."),f=m,d=j):(d||g("Unexpected character."),q.b())}}t(Y,C);
Y.prototype.name="ContextSelector";function zb(a){var b=m;this.execute=function(c,d){var e;c.c();switch(c.charAt(0)){case "[":if(!b){b=j;c.shift(1);e=new B;a.add("[").add(e);d.a(new Z(e,j));return}break;case "]":if(b){b=m;c.shift(1);a.add("]");d.b();return}}g("Unexpected character: '"+c.charAt(0)+"'.")}}t(zb,C);zb.prototype.name="ContextDynamicRefinement";function Z(a,b){this.f=function(){return a};this.H=function(){return new X(a,b)};this.G=function(a){return new Ab(a)}}t(Z,F);Z.prototype.name="ContextExpression";
function Ab(a){this.getExpression=function(a){return new Z(a,j)};this.f=function(){return a}}t(Ab,I);Ab.prototype.name="ContextParenthesizedExpression";
function vb(a){this.execute=function(b,c){var d=b.match(ea);d&&(d=d[1],b.shift(d.length),c.i("normalizespace")&&(d=d.replace(/\s+/g," ")),c.i("minifyhtml")&&(d=d.replace(na,"$1$2")),d=d.replace(/\\#/g,"#"),d=d.replace(/\\\{/g,"{"),d=d.replace(/\\(?![n'])/g,"\\\\"),d=d.replace(/^'|([^\\])'/g,"$1\\'"),d=d.replace(/\r?\n/g,"\\n"),a.add("b('"+d+"');"));c.b()}}t(vb,C);vb.prototype.name="InputTokens";
function ub(a){var b=m,c=new B;this.execute=function(d,e){var f,k;b&&"}"!==d.charAt(0)&&((k=d.match(ja))||g("Invalid PrintModifier.  \nValid PrintModifiers are: 'e' 'E'.\nExample:  {name|e}"),k=k[1],-1<k.indexOf("e")?f=m:-1<k.indexOf("E")?f=j:g("Unknown PrintModifier:  \n"+k+"Valid PrintModifiers are: 'e' 'E'.\nExample:  {name|e}"),d.shift(k.length));switch(d.charAt(0)){case "{":if(!b){b=j;c=new B;d.shift(1);e.a(new W(c));return}break;case "}":if(b){d.shift(1);a.add("b(");e.i("escapexss")&&void 0===
f||f?(e.J||(e.J=j,e.e.put("X",e.d.ja())),a.add("X(").add(c).add(")")):a.add(c);a.add(");");e.b();return}}g("Invalid Character.")}}t(ub,C);ub.prototype.name="PrintStatement";
function Q(a){var b=new B,c=j,d=new B;a.add("if(").add(b).add("){").add(d).add("}");this.I=function(){return new W(b)};this.B=function(){return new P(d)};this.Q=function(b,d){var k,h=new B;c||g("Continuations are not allowed after {:else}");b.va()?(c=m,b.shift(7),a.add("else{").add(h).add("}"),d.a(new P(h))):(k=b.match(Ga))?(b.shift(k[1].length),a.add("else ").add(h),d.b().a(new Q(h))):g("Unknown continuation.")}}t(Q,E);Q.prototype.name="IfStatement";Q.prototype.C=function(){return xa};
function sb(a,b){var c=new B,d=m;b.i("removelogs")||a.add("console.log(").add(c).add(");");this.execute=function(a,b){a.c();d?"}"===a.charAt(0)?(a.shift(1),b.b()):g("Invalid character."):(d=j,b.a(new W(c)))}}t(sb,C);sb.prototype.name="LogStatement";function R(a){var b=new B,c=new B,d=new B;this.N=j;a.add("b").add("(").add(b).add("(").add(c).add(d).add(")").add(");");this.I=function(){return new Bb(b,c)};this.B=function(){return new $(d)}}t(R,E);R.prototype.C=function(){return ta};
R.prototype.name="RenderStatement";function $(a){var b=new ab(",{","",":","}",null),c=j;this.j=function(){return b};this.D=function(){c&&(c=m,a.add(b));return new Cb(b)}}t($,H);$.prototype.name="RenderParams";$.prototype.u="p";$.prototype.F=function(){return y};function Cb(a){this.j=function(){return a}}t(Cb,G);r=Cb.prototype;r.name="RenderParamDeclaration";r.p=function(){return y};r.q=function(a){return new U(a)};r.n=p();r.o=function(){g("An assignment must be made here.")};
function Bb(a,b){var c=m;this.execute=function(d,e){var f;if(!c){if(f=d.match(fa))c=j,f=f[1],d.shift(f.length),a.add("B."+f),e.A(f);else if(f=d.match(w))c=j,f=f[1],d.shift(f.length),a.add("N."+f),e.A(e.R()+"."+f);if(c){e.b();d.c();f=d.charAt(0);"/"!==f&&"}"!==f?e.a(new Y(b,m)):b.add("x");return}g("A valid Namespace must be given.")}g("Invalid Character")}}t(Bb,C);Bb.prototype.name="RenderExpression";
function tb(a){this.execute=function(b,c){var d;if(d=b.match(pa))d=d[1],b.shift(d.length),a.add("b('"+d.replace("\\","\\\\").replace(/\r?\n/g,"\\\n").replace("'","\\'")+"');");(d=b.match(Fa))?(b.shift(d[1].length),c.b()):g("Unexpected character.")}}t(tb,C);tb.prototype.name="TextStatement";
function S(a,b){var c=new B,d=new B,e=new B;c.add("g(").add(d).add(")");a.add("e(").add(c).add(",").add("function(x,O,L,n){").add(e).add("});");b.e.put("e",b.d.ia()).put("g",b.d.ka());this.I=function(){return new Y(d,m)};this.B=function(){return new Db(e,c)}}t(S,E);S.prototype.name="ForeachStatement";S.prototype.C=function(){return va};
function Db(a,b){var c=m,d=m,e=m;this.execute=function(f,k){var h;f.c();e||(e=j,k.P());switch(f.charAt(0)){case "{":switch(f.charAt(1)){case "s":if(!c&&!d&&(h=f.match(Ba))){f.shift(h[1].length);k.a(new Eb(b,k));return}break;case "v":if(!c&&!d&&(c=j,h=f.match(z))){a.add(k.h());k.a(new M(k.h()));return}break;case "/":k.b();k.X();return}default:d=j,k.a(new P(a))}}}t(Db,C);Db.prototype.name="ForeachBodyStatements";
function Eb(a,b){var c=new B;b.e.put("s",b.d.ma());var d=m,e=m;this.execute=function(b,k){b.c();if(d){if(!e){var h=b.match(ka);if(h){e=j;var n=h[1];b.shift(n.length);var h=0,l=m,q=0,u=0;switch(n){case "|asc":h=0;break;case "|desc":h=1;break;case "|rand":h=2}if(n=b.match(la))2===h&&g("Modifiers are not allowed after |rand"),n=n[1],b.shift(n.length),-1<n.indexOf("i")&&(u=1,/i[^i]*?i/i.test(n)&&g("'i' may only appear once in sort options.")),(l=-1<n.indexOf("n"))&&/n[^n]*?n/i.test(n)&&g("'n' may only appear once in sort options."),
-1<n.indexOf("c")?q=1:-1<n.indexOf("C")&&(q=2),q&&/c[^c]*?c/i.test(n)&&g("Only one of 'c' or 'C' may appear in sort options.");c.add(","+h+","+(l?1:0)+","+q+","+u)}else g("Sort direction must be one of '|asc', '|desc' or '|rand'.")}e||g("One of '|asc', '|desc' or '|rand' is required.");"}"===b.charAt(0)?(b.shift(1),k.b()):g("Invalid Character.")}else d=j,h=new B,a.sa().append(c).append(")"),c.add(",function(x, n){return ").add(h).add("}"),k.a(new Y(h,j))}}t(Eb,C);Eb.prototype.name="SortStatement";
function hb(){var a={},b={};this.K=function(b){a[b]=j;return this};this.A=function(a){b[a]=j;return this};this.S=function(a){return b.hasOwnProperty(a)};this.T=function(b){return a.hasOwnProperty(b)};this.wa=function(){for(var c in b)a.hasOwnProperty(c)||g(c+" has not been declared.")}}
function ba(a){a=a||{};var b={debug:m,escapexss:j,global:j,minifyhtml:j,normalizespace:j,removelogs:j,useexternal:m,warn:m},c;for(c in a)b[c]=a[c];this.aa=b;this.d=new eb(b);this.compile=function(a,b,c){(!a||"string"!==typeof a)&&g("No template string to parse.");var k=new B;a=new fb(a);var h=new gb(k,this,c);b&&h.ua(b);try{for(h.a(new jb(k,h,!!c));0<a.length();)h.ca(a);h.close()}catch(n){g("=========================\n"+h.ga().name+":\n-------------------------\n"+n+"\n\n   Line       : "+a.oa()+
"\n   Column     : "+a.fa()+"\n=========================\n")}return k.toString()}}"undefined"!==typeof module&&module.exports?(this.XforJS=module.exports=s,s.server=j):this.XforJS=s;}();
